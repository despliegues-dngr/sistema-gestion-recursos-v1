---
description: Patrones y buenas prÃ¡cticas para bases de datos cliente y seguridad
globs:
  - "**/*database*.ts"
  - "**/*db*.ts"
  - "**/*storage*.ts"
  - "src/services/**/*.ts"
  - "src/stores/**/*.ts"
  - "src/composables/**/*.ts"
  - "src/hooks/**/*.ts"
  - "**/*auth*.ts"
  - "**/*security*.ts"
alwaysApply: false
---

# ğŸ—„ï¸ğŸ”’ Patrones y Buenas PrÃ¡cticas

## Base de Datos del Cliente

### DatabaseService

- âœ… **SIEMPRE** usar servicio centralizado para operaciones DB
- âœ… Cifrar datos sensibles antes de almacenar cuando sea necesario
- âœ… Usar transacciones para operaciones atÃ³micas
- âœ… Manejar errores de DB apropiadamente

### Operaciones CRUD

```typescript
// âœ… PatrÃ³n correcto
const record = await databaseService.create('table', {
  field1: 'value1',
  field2: 'value2',
  timestamp: Date.now()
})

// Cifrado automÃ¡tico si estÃ¡ configurado
```

### Stores y Base de Datos

- âœ… Coordinar entre stores y servicio de base de datos
- âœ… No acceder directamente a IndexedDB/localStorage desde componentes
- âœ… Usar stores para estado reactivo, services para persistencia

### Consultas

- âœ… Usar Ã­ndices apropiados para consultas frecuentes
- âœ… Consultar schema del proyecto para estructura de datos
- âœ… Optimizar queries para performance offline

### Migraciones

- âœ… Documentar cambios de schema
- âœ… Implementar versionado de DB apropiadamente
- âœ… Mantener historial de cambios de base de datos

---

## Seguridad

### Cifrado y Datos Sensibles

- âœ… **SIEMPRE** cifrar datos sensibles con `encryptionService` antes de almacenar
- âœ… **NUNCA** almacenar contraseÃ±as en texto plano
- âœ… Usar PBKDF2 (100K iteraciones) para derivaciÃ³n de claves
- âœ… Usar AES-256-GCM para cifrado de datos

### AutenticaciÃ³n

- âœ… Implementar RBAC (Role-Based Access Control) apropiado
- âœ… Validar permisos en cada operaciÃ³n crÃ­tica
- âœ… Usar sesiones persistentes seguras (IndexedDB cifrado cuando aplique)

### ValidaciÃ³n de Entrada

- âœ… **SIEMPRE** validar y sanitizar input del usuario
- âœ… Usar validaciones del lado del cliente Y del servidor cuando aplique
- âœ… Prevenir inyecciÃ³n SQL/NoSQL (aunque usemos IndexedDB, aplicar principios)

### AuditorÃ­a

- âœ… Registrar todos los eventos crÃ­ticos en sistema de auditorÃ­a
- âœ… Tipos de eventos comunes: auth, user_management, data_operation, backup, system_error
- âœ… Logs inmutables (no modificar despuÃ©s de crear)

### Referencias de Seguridad

- Consultar documentaciÃ³n de seguridad del proyecto
- Seguir OWASP Top 10:2021
- Cumplir regulaciones locales de protecciÃ³n de datos
- Aplicar principios de seguridad por defecto
